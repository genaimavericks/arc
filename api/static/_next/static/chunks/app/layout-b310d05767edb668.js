(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3347:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,9324,23)),Promise.resolve().then(r.bind(r,9404)),Promise.resolve().then(r.bind(r,1069)),Promise.resolve().then(r.bind(r,9474))},9404:(e,t,r)=>{"use strict";r.d(t,{ActivityTracker:()=>i});var o=r(2115),a=r(6046),s=r(1069),n=r(7358);function i(){let e=(0,a.usePathname)(),{user:t}=(0,s.A)();return(0,o.useEffect)(()=>{if(!t)return;let r=async()=>{try{let r=n.env.NEXT_PUBLIC_API_URL||"/api",o=localStorage.getItem("token");if(!o)return;await fetch("".concat(r,"/admin/activity/log"),{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({action:"Page visit",details:"Visited ".concat(e),page_url:e,username:t.username})})}catch(e){console.error("Failed to log page visit:",e)}},o=setTimeout(()=>{r()},300);return()=>clearTimeout(o)},[e,t]),null}},1069:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>l});var o=r(5155),a=r(2115),s=r(6046),n=r(7358);let i=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[d,h]=(0,a.useState)(null),m=(0,s.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{l(JSON.parse(e))}catch(e){console.error("Failed to parse stored user",e),localStorage.removeItem("user")}u(!1)},[]);let g=async(e,t)=>{u(!0),h(null);try{let r=n.env.NEXT_PUBLIC_API_URL||"/api",o="".concat(r,"/auth/token");console.log("Attempting to login at:",o);let a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:e,password:t})});if(!a.ok){let e=await a.json();throw Error(e.detail||"Login failed")}let s=await a.json();localStorage.setItem("token",s.access_token),localStorage.setItem("user",JSON.stringify({username:s.username,role:s.role,permissions:s.permissions||[]})),l({username:s.username,role:s.role,permissions:s.permissions||[]}),m.push("/")}catch(e){console.error("Login error:",e),h(e instanceof Error?e.message:"Login failed. Please check your credentials.")}finally{u(!1)}},f=async function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user";u(!0),h(null);try{let a=n.env.NEXT_PUBLIC_API_URL||"/api",s="".concat(a,"/auth/register");console.log("Attempting to register at:",s);let i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:r,role:o})});if(!i.ok){let e=await i.json();throw Error(e.detail||"Registration failed")}await g(e,r)}catch(e){console.error("Registration error:",e),h(e instanceof Error?e.message:"Registration failed"),u(!1)}},p=async e=>{u(!0),h(null);try{let t=n.env.NEXT_PUBLIC_API_URL||"/api",r="".concat(t,"/auth/forgot-password");console.log("Requesting password reset at:",r);let o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!o.ok){let e=await o.json();throw Error(e.detail||"Failed to process request")}}catch(e){console.error("Forgot password error:",e),h(e instanceof Error?e.message:"Failed to process request")}finally{u(!1)}},w=async(e,t)=>{u(!0),h(null);try{let r=n.env.NEXT_PUBLIC_API_URL||"/api",o="".concat(r,"/auth/reset-password");console.log("Resetting password at:",o);let a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,password:t})});if(!a.ok){let e=await a.json();throw Error(e.detail||"Failed to reset password")}}catch(e){throw console.error("Reset password error:",e),h(e instanceof Error?e.message:"Failed to reset password"),e}finally{u(!1)}};return(0,o.jsx)(i.Provider,{value:{user:r,login:g,register:f,forgotPassword:p,resetPassword:w,logout:()=>{sessionStorage.setItem("isLoggingOut","true"),localStorage.removeItem("token"),localStorage.removeItem("user"),l(null),m.push("/")},isLoading:c,error:d},children:t})}function c(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9474:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,ThemeProvider:()=>n});var o=r(5155),a=r(2115);let s=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,a.useState)("dark");return(0,a.useEffect)(()=>{let e=localStorage.getItem("theme");e?n(e):n(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},[]),(0,a.useEffect)(()=>{"dark"===r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",r)},[r]),(0,o.jsx)(s.Provider,{value:{theme:r,toggleTheme:()=>{n(e=>"dark"===e?"light":"dark")},setTheme:n},children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6046:(e,t,r)=>{"use strict";var o=r(6658);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},9324:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[533,441,517,358],()=>t(3347)),_N_E=e.O()}]);